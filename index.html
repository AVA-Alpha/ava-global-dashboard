<!DOCTYPE html>
<html lang="en">

<script>
    (function (c, a) {
        if (!a.__SV) {
            var b = window; try { var d, m, j, k = b.location, f = k.hash; d = function (a, b) { return (m = a.match(RegExp(b + "=([^&]*)"))) ? m[1] : null }; f && d(f, "state") && (j = JSON.parse(decodeURIComponent(d(f, "state"))), "mpeditor" === j.action && (b.sessionStorage.setItem("_mpcehash", f), history.replaceState(j.desiredHash || "", c.title, k.pathname + k.search))) } catch (n) { } var l, h; window.mixpanel = a; a._i = []; a.init = function (b, d, g) {
                function c(b, i) {
                    var a = i.split("."); 2 == a.length && (b = b[a[0]], i = a[1]); b[i] = function () {
                        b.push([i].concat(Array.prototype.slice.call(arguments,
                            0)))
                    }
                } var e = a; "undefined" !== typeof g ? e = a[g] = [] : g = "mixpanel"; e.people = e.people || []; e.toString = function (b) { var a = "mixpanel"; "mixpanel" !== g && (a += "." + g); b || (a += " (stub)"); return a }; e.people.toString = function () { return e.toString(1) + ".people (stub)" }; l = "disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
                for (h = 0; h < l.length; h++)c(e, l[h]); var f = "set set_once union unset remove delete".split(" "); e.get_group = function () { function a(c) { b[c] = function () { call2_args = arguments; call2 = [c].concat(Array.prototype.slice.call(call2_args, 0)); e.push([d, call2]) } } for (var b = {}, d = ["get_group"].concat(Array.prototype.slice.call(arguments, 0)), c = 0; c < f.length; c++)a(f[c]); return b }; a._i.push([b, d, g])
            }; a.__SV = 1.2; b = c.createElement("script"); b.type = "text/javascript"; b.async = !0; b.src = "undefined" !== typeof MIXPANEL_CUSTOM_LIB_URL ?
                MIXPANEL_CUSTOM_LIB_URL : "file:" === c.location.protocol && "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//) ? "https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js" : "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js"; d = c.getElementsByTagName("script")[0]; d.parentNode.insertBefore(b, d)
        }
    })(document, window.mixpanel || []);
    mixpanel.init("a49dacb01e9183db1b59ca521e8618a9", { batch_requests: true })
</script>

<head>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans+Condensed:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <link rel="stylesheet" href="./styles.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>

    <title>AVA Fundamental Dashboard</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">
            <img src="https://avaadvisory.hk/wp-content/uploads/2020/05/AVA-logo-color@3x.png" width="30" height="30"
                class="d-inline-block align-top" alt="">
            AVA Fundamental Dashboard
        </a>

        <select class="searchbox" style="width: 10%" name="state">
        </select>

        <!-- <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" id="symbolSearch" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" id="submitBtn" type="submit">Search</button>
          </form> -->
    </nav>

        <div class="flex-container">
            <div class="flex-row">
                <div class="flex-item" id="price-chart"></div>
                <div class="flex-item " id="information">
                    <div class="row">
                        <!-- Information -->
                        <div class="col-5">
                            <div class="row">
                                <div class="col-8" id="information-symbol"></div>
                                <div class="col-4">
                                    <div class="row">
                                        <div class="col-1 information-currency" id="information-currency"></div>
                                        <div class="col-2" id="information-price"></div>
                                    </div>
                                    <!-- <div class="information-currency" id="information-currency"></div> 
                                <div id="information-price"></div>  -->
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-8" id="information-name"></div>
                                <div class="col-4">
                                    <div class="" id="information-chg-arrow"></div>
                                    <div id="information-chg"></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12" id="information-sector"></div>
                            </div>
                            <div class="row">
                                <div class="col-12" id="information-desc"></div>
                            </div>
                        </div>
                        <!-- Scores -->
                        <div class="col-5">
                            <div class="row">
                                <div class="col-12 metric-text" id="icr-text"></div>
                                <div class="col-12"><canvas id="icr-score" height="20"></canvas></div>
                            </div>
                            <div class="row">
                                <div class="col-12 metric-text" id="la-text"></div>
                                <div class="col-12"><canvas id="la-score" height="20"></canvas></div>
                            </div>
                            <div class="row">
                                <div class="col-12 metric-text" id="ocq-text"></div>
                                <div class="col-12"><canvas id="ocq-score" height="20"></canvas></div>
                            </div>
                            <div class="row">
                                <div class="col-12 metric-text" id="rev-text"></div>
                                <div class="col-12"><canvas id="rev-score" height="20"></canvas></div>
                            </div>
                            <div class="row">
                                <div class="col-12 metric-text" id="valuation-text"></div>
                                <div class="col-12"><canvas id="valuation-score" height="20"></canvas></div>
                            </div>
                        </div>
                        <!-- AVA Score-->
                        <div class="col-2">
                            <div class="ava-scorebox">
                                <div class="row avascore" id="avascore"></div>
                                <div class="row avatext">AVA SCORE</div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div>
                    <div class="flex-item" id="ic-chart">
                        <div id="tooltip" class="tooltip">
                            <div class="tooltip-range">
                                Growth: <span id="range"></span>
                            </div>
                            <div class="tooltip-value">
                                <span id="count"></span> days
                            </div>
                        </div>
                    </div>
                    <div class="flex-item" id="ic-areachart"></div>
                </div>
                <div class="flex-item" id="ic-table"></div>
            </div>

            <div class="flex-row">
                <div class="flex-item" id="bs-chart"></div>
                <div class="flex-item" id="bs-table"></div>
            </div>

            <div class="flex-row">
                <div class="flex-item" id="cs-chart"></div>
                <div class="flex-item" id="cs-table"></div>
            </div>
        </div>

        <div id="wrapper"></div>

        <script src="./d3.js"></script>
        <script src="./mediator.js"></script>
        <script src="./pricechart.js"></script>
        <script src="./stepline.js"></script>
        <script src="./ALEstepline.js"></script>
        <script src="./table.js"></script>
        <script src="./linepointchart.js"></script>
        <script src="./areachart.js"></script>
        <script src="./info.js"></script>
        <script src="./vis.js"></script>

        <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script> -->
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
            integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue"></script>

        <script>
            var USER_ID = "12345";
            var USER_SIGNUP_DATE = "2020-09-15";

            mixpanel.identify(USER_ID);
            mixpanel.people.set({
              "$email": "testuser@ava.ava",
              "Sign up date": USER_SIGNUP_DATE, 
              "USER_ID": USER_ID,
              "credits": 150
            });
            
            mixpanel.track_links('#modeBtn', 'Clicked switch button');
            
            // $(document).ready(function() {
            //     $('.js-example-basic-single').select2();
            // });
            // $('.js-example-basic-single').on('select2:select', function (e) {
            // var data = e.params.data;
            // draw(data['id'])
            // });

            function formatState(state) {
                console.log(state);
                return `(${state.id}) ${state.text}`;
            };
            $(document).ready(function () {
                $(".searchbox").select2({
                    minimumInputLength: 2,
                    templateResult: formatState, //this is for append country flag.
                    ajax: {
                        url: 'https://api.avantis.app/api/search',
                        dataType: 'json',
                        type: "GET",
                        headers: {
                            'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE4OTM0NTYwMDAsInVzZXJuYW1lIjoieW9ydCJ9.GGYlZFvQfYJTT3VU6owQXImwD3tsO9HICMG83sgSPYU',
                            'Content-Type': 'application/json'
                        },
                        data: function (params) {
                            return {
                                text: params.term,
                                limit: 10
                            };
                        },
                        processResults: function (data) {
                            console.log(data)
                            return {
                                results: $.map(data, function (item) {
                                    return {
                                        text: item.description,
                                        id: item.symbol,
                                        //contryflage:item.state.coutry.sortname
                                    }
                                })
                            };
                        }
                    }
                });
                $('.searchbox').on('select2:select', function (e) {
                    var data = e.params.data;
                    mixpanel.track("Search Symbol", {"name": data['id']});
                    draw(data['id'])
                    drawInfo(data['id'])
                    console.log('Search: ',data['id'])
                    
                });
            });
        </script>
</body>
</html>